name: Deploy master to GitHub Pages
concurrency: deploy-master
on:
    push:
        branches:
        - master

permissions:
  contents: write

jobs:
  deploy-master:
    runs-on: ubuntu-latest
    steps:
        # Checkout code and build the project
        - name: Checkout code
          uses: actions/checkout@v6
          with:
            token: ${{ secrets.GITHUB_TOKEN }}

        - name: Checkout Building Blocks
          uses: actions/checkout@v6
          with:
            path: building-blocks
            repository: CSA-FEDERATE/Proposed-BuildingBlocks

        - name: Use Node.js
          uses: actions/setup-node@v6
          with:
            node-version: '24.13'
            token: ${{ secrets.GITHUB_TOKEN }}

        - name: Set up Python
          uses: actions/setup-python@v6
          with:
            python-version: '3.13'

        - name: Run CI scripts
          run: |
            find .
            chmod +x ci/*.sh
            ci/transform.sh building-blocks building-blocks_structure.json
            mv building-blocks_structure.json ./src/assets/
            ci/build.sh

        - name: Deploy to GitHub Pages
          uses: JamesIves/github-pages-deploy-action@v4
          with:
            folder: dist
            branch: gh-pages
            clean-exclude: pr-preview/ # Exclude the pr-preview folder from being deleted during deployment
            force: false # Prevent force pushing to the gh-pages branch, which can cause issues with PR previews